
<<div id="dailyMessage" style="
  background:#bbf7d0;
  color:#14532d;
  padding:10px 15px;
  border-radius:12px;
  margin:15px;
  font-size:14px;
  font-weight:bold;
  text-align:center;
  display:none;
"></div>
!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Clinic Entry - DSA Lab</title>

<style>
body {
  font-family: "Tahoma", sans-serif;
  background: #f7f7f7;
  margin: 0;
  padding: 20px;
}

.container {
  max-width: 450px;
  margin: auto;
  background: #ffffff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

h2 {
  text-align: center;
  margin-bottom: 20px;
}

label {
  font-size: 14px;
  font-weight: bold;
  display: block;
  margin-top: 12px;
}

input, select, textarea {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

button {
  width: 100%;
  margin-top: 15px;
  padding: 12px;
  border: none;
  background: #1976d2;
  color: white;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
}

button:hover {
  background: #0b63b0;
}

.qr-preview {
  margin-top: 20px;
  text-align: center;
}
</style>
</head>
<body>

<div class="container">
  <h2>ğŸ“‹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</h2>

  <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù (MRN)</label>
  <input type="text" id="mrn" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù" />

  <button onclick="fetchFromR4()">Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶ (R4)</button>

  <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</label>
  <input type="text" id="patientName" />

  <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨</label>
  <input type="text" id="doctorName" />

  <label>Ø±Ù‚Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</label>
  <input type="text" id="clinicNumber" />

  <label>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„Ø©</label>
  <select id="caseType">
    <option>TM</option>
    <option>CD</option>
    <option>RPD</option>
    <option>PFM</option>
    <option>Ortho</option>
    <option>Resin</option>
  </select>

  <label>Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</label>
  <select id="departments" multiple>
    <option>TM</option>
    <option>CD</option>
    <option>RPD</option>
    <option>PFM</option>
    <option>Ortho</option>
    <option>Resin</option>
  </select>

  <label>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø±ÙŠØ¶ Ø§Ù„Ù‚Ø§Ø¯Ù…</label>
  <input type="date" id="nextAppointment" />

  <label>Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨</label>
  <input type="file" id="fileUpload" />

  <button onclick="saveCase()">Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© â•</button>

  <div class="qr-preview" id="qrContainer"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
function fetchFromR4() {
  alert("Ù…ÙŠØ²Ø© Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ R4 Ø³ØªØ¹Ù…Ù„ Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© IT. (Placeholder)");
}

function generateLabId() {
  return "DSA-" + Date.now();
}

function saveCase() {
  let caseId = generateLabId();

  let data = {
    caseId: caseId,
    mrn: document.getElementById("mrn").value,
    patientName: document.getElementById("patientName").value,
    doctorName: document.getElementById("doctorName").value,
    clinicNumber: document.getElementById("clinicNumber").value,
    caseType: document.getElementById("caseType").value,
    departments: Array.from(document.getElementById("departments").selectedOptions).map(o => o.value),
    nextAppointment: document.getElementById("nextAppointment").value,
    createdAt: new Date().toLocaleString()
  };

  let cases = JSON.parse(localStorage.getItem("clinicCases") || "[]");
  cases.push(data);
  localStorage.setItem("clinicCases", JSON.stringify(cases));

  showQR(caseId);
  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­! Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„: " + caseId);
}

function showQR(code) {
  document.getElementById("qrContainer").innerHTML = "";
  new QRCode(document.getElementById("qrContainer"), code);
}
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>DSA One-Page Lab System</title>

<style>
body { font-family: Tahoma; background: #f2f2f2; padding: 0; margin: 0; }
header {
  background: #1976d2; color: white; padding: 15px; text-align: center;
  font-size: 20px; font-weight: bold;
}
nav {
  display: flex; flex-wrap: wrap; background: #ffffff;
  padding: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}
nav button {
  flex: 1; margin: 5px; padding: 10px;
  border: none; background: #e3e3e3; border-radius: 8px; cursor: pointer;
  font-weight: bold;
}
nav button:hover { background: #cccccc; }

.section {
  display: none;
  padding: 20px;
  background: #ffffff;
  margin: 15px;
  border-radius: 12px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}
label { display: block; margin-top: 10px; font-weight: bold; }
input, select { width: 100%; padding: 10px; margin-top: 5px; border-radius: 8px; border: 1px solid #ccc; }
button.action {
  width: 100%; padding: 12px; background: #1976d2; color: white;
  font-size: 16px; border: none; border-radius: 8px; margin-top: 15px;
}
button.action:hover { background: #0f5aa0; }

#qrContainer { margin-top: 20px; text-align: center; }
</style>

</head>
<body>

<header>ğŸ“Œ DSA â€“ One Page Lab Workflow System</header>

<nav>
  <button onclick="showSection('clinicEntry')">ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ù„Ø©</button>
  <button onclick="showSection('driverPickup')">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ù„</button>
  <button onclick="showSection('assistantReceive')">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
  <button onclick="showSection('assignTech')">ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ</button>
  <button onclick="showSection('techDashboard')">Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ</button>
  <button onclick="showSection('finalDelivery')">Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</button>
  <button onclick="showSection('returnedCases')">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø§Ø¬Ø¹Ø©</button>
  <button onclick="showSection('stats')">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
</nav>

<!-- â–‘â–‘â–‘ SECTION: ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© â–‘â–‘â–‘ -->
<div class="section" id="clinicEntry">
  <h2>ğŸ“‹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</h2>

  <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù</label>
  <input id="mrn">

  <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</label>
  <input id="patientName">

  <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨</label>
  <input id="doctorName">

  <label>Ø±Ù‚Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</label>
  <input id="clinicNumber">

  <label>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„Ø©</label>
  <select id="caseType">
    <option>TM</option><option>CD</option><option>RPD</option>
    <option>PFM</option><option>Ortho</option><option>Resin</option>
  </select>

  <label>Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</label>
  <select id="departments" multiple>
    <option>TM</option><option>CD</option><option>RPD</option>
    <option>PFM</option><option>Ortho</option><option>Resin</option>
  </select>

  <label>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø±ÙŠØ¶ Ø§Ù„Ù‚Ø§Ø¯Ù…</label>
  <input type="date" id="nextAppointment">

  <button class="action" onclick="saveClinicCase()">Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© â•</button>

  <div id="qrContainer"></div>
</div>

<!-- â–‘â–‘â–‘ SECTION: Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ â–‘â–‘â–‘ -->
<div class="section" id="driverPickup">
  <h2>ğŸšš Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</h2>

  <label>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ (Lab ID)</label>
  <input id="driverLabId">

  <button class="action" onclick="driverReceive()">âœ” ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø­Ø§Ù„Ø©</button>
</div>

<!-- â–‘â–‘â–‘ SECTION: Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© â–‘â–‘â–‘ -->
<div class="section" id="assistantReceive">
  <h2>ğŸ§• Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ø¹Ù…Ù„</h2>

  <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„</label>
  <input id="assistantLabId">

  <button class="action" onclick="assistantReceiveCase()">âœ” ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
</div>

<!-- â–‘â–‘â–‘ SECTION: ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ â–‘â–‘â–‘ -->
<div class="section" id="assignTech">
  <h2>ğŸ›  ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙÙ†ÙŠ</h2>

  <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„</label>
  <input id="assignLabId">

  <label>Ø§Ø®ØªØ± Ø§Ù„ÙÙ†ÙŠ</label>
  <select id="technicianName">
    <option>ÙÙ‡Ø¯ (TM)</option>
    <option>Ø£Ø­Ù…Ø¯ (RPD)</option>
    <option>Ø±ÙŠØ§Ø¶ (CD)</option>
  </select>

  <button class="action" onclick="assignTechnician()">ğŸ“Œ ØªØ­ÙˆÙŠÙ„ Ù„Ù„ÙÙ†ÙŠ</button>
</div>

<!-- â–‘â–‘â–‘ SECTION: Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ â–‘â–‘â–‘ -->
<div class="section" id="techDashboard">
  <h2>ğŸ§‘â€ğŸ”§ Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ</h2>

  <label>Ø§Ø³Ù… Ø§Ù„ÙÙ†ÙŠ</label>
  <select id="techFilter">
    <option>ÙÙ‡Ø¯ (TM)</option>
    <option>Ø£Ø­Ù…Ø¯ (RPD)</option>
    <option>Ø±ÙŠØ§Ø¶ (CD)</option>
  </select>

  <button class="action" onclick="loadTechCases()">Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª</button>

  <div id="techCasesList"></div>
</div>

<!-- â–‘â–‘â–‘ SECTION: Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ â–‘â–‘â–‘ -->
<div class="section" id="finalDelivery">
  <h2>ğŸ“¦ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©</h2>

  <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„</label>
  <input id="finalLabId">

  <button class="action" onclick="finalDeliver()">âœ” ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>
</div>

<!-- â–‘â–‘â–‘ SECTION: Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© â–‘â–‘â–‘ -->
<div class="section" id="returnedCases">
  <h2>ğŸ” Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø§Ø¬Ø¹Ø©</h2>
  <div id="returnedList"></div>
</div>

<!-- â–‘â–‘â–‘ SECTION: Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª â–‘â–‘â–‘ -->
<div class="section" id="stats">
  <h2>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
  <div id="statsContent"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
function showSection(id){
  document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
  document.getElementById(id).style.display = 'block';
}

/* ---------- Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© ---------- */
function saveClinicCase(){
  let cases = JSON.parse(localStorage.getItem("cases") || "[]");

  let newCase = {
    labId: "DSA-" + Date.now(),
    mrn: mrn.value,
    patient: patientName.value,
    doctor: doctorName.value,
    clinic: clinicNumber.value,
    type: caseType.value,
    dept: Array.from(departments.selectedOptions).map(o => o.value),
    next: nextAppointment.value,
    status: "ClinicEntry"
  };

  cases.push(newCase);
  localStorage.setItem("cases", JSON.stringify(cases));

  qrContainer.innerHTML = "";
  new QRCode(qrContainer, newCase.labId);

  alert("âœ” ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©: " + newCase.labId);
}

/* ---------- Ø§Ù„Ø¹Ø§Ù…Ù„ ---------- */
function driverReceive(){
  updateStatus(driverLabId.value, "DriverReceived");
  alert("âœ” Ø§Ù„Ø¹Ø§Ù…Ù„ Ø§Ø³ØªÙ„Ù… Ø§Ù„Ø­Ø§Ù„Ø©");
}

/* ---------- Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ---------- */
function assistantReceiveCase(){
  updateStatus(assistantLabId.value, "AssistantReceived");
  alert("âœ” Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ø³ØªÙ„Ù…Øª Ø§Ù„Ø­Ø§Ù„Ø©");
}

/* ---------- ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ ---------- */
function assignTechnician(){
  updateStatus(assignLabId.value, "WithTechnician", technicianName.value);
  alert("âœ” ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù„ÙÙ†ÙŠ");
}

/* ---------- Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ ---------- */
function loadTechCases(){
  let tech = techFilter.value;
  let cases = JSON.parse(localStorage.getItem("cases") || "[]");

  let list = cases.filter(c => c.technician === tech);

  let html = "";
  list.forEach(c => {
    html += `<div style='padding:10px;border-bottom:1px solid #ccc'>
      <b>${c.labId}</b> - ${c.patient} <br>
      <button onclick="completeCase('${c.labId}')">âœ” Ø¥Ù†Ù‡Ø§Ø¡</button>
      <button onclick="returnCase('${c.labId}')">ğŸ” Ø¥Ø±Ø¬Ø§Ø¹</button>
    </div>`;
  });

  techCasesList.innerHTML = html;
}

/* ---------- Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ÙÙ†ÙŠ ---------- */
function completeCase(labId){
  updateStatus(labId, "Completed");
  alert("âœ” ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„Ø©");
}

/* ---------- Ø¥Ø±Ø¬Ø§Ø¹ ---------- */
function returnCase(labId){
  updateStatus(labId, "Returned");
  alert("ğŸ” Ø§Ù„Ø­Ø§Ù„Ø© Ø±Ø¬Ø¹Øª Ù„Ù„ÙÙ†ÙŠ/Ø§Ù„Ù…Ø¹Ù…Ù„");
}

/* ---------- Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ---------- */
function finalDeliver(){
  updateStatus(finalLabId.value, "DeliveredToClinic");
  alert("ğŸ“¦ ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©");
}

/* ---------- ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© ---------- */
function updateStatus(labId, status, tech=null){
  let cases = JSON.parse(localStorage.getItem("cases") || "[]");

  cases = cases.map(c => {
    if(c.labId === labId){
      c.status = status;
      if(tech) c.technician = tech;
    }
    return c;
  });

  localStorage.setItem("cases", JSON.stringify(cases));
}
</script>

</body>
</html><!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>DSA Lab System v1</title>

<style>
body { font-family: Tahoma; background:#f3f3f3; margin:0; padding:0;}
header {
  background:#1565c0; color:white; padding:15px;
  text-align:center; font-size:22px; font-weight:bold;
}
nav {
  display:flex; flex-wrap:wrap; padding:10px; background:#fff;
  box-shadow:0 3px 10px rgba(0,0,0,0.1);
}
nav button {
  flex:1; margin:5px; padding:12px; font-weight:bold;
  border:none; border-radius:8px;
  background:#e0e0e0; cursor:pointer;
}
nav button:hover { background:#cfcfcf; }

.section {
  display:none; background:#fff; margin:20px; padding:20px;
  border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,0.1);
}
h2 { margin-top:0; }

input, select, textarea {
  width:100%; padding:10px; margin-top:5px;
  border-radius:8px; border:1px solid #ccc;
}
label { margin-top:12px; font-weight:bold; display:block; }

button.action {
  width:100%; padding:12px;
  margin-top:15px; border:none; border-radius:10px;
  background:#1565c0; color:white; font-size:16px;
  cursor:pointer;
}
button.action:hover { background:#0f4f90; }

.case-card {
  background:#f7f7f7; padding:12px;
  margin:8px 0; border-radius:10px; border:1px solid #ddd;
}

#qrBox { text-align:center; margin-top:20px; }
</style>
</head>

<body>

<header>ğŸ“Œ Ù†Ø¸Ø§Ù… Ù…Ø¹Ù…Ù„ Ø§Ù„Ø£Ø³Ù†Ø§Ù† â€“ DSA Lab System (Complete v1)</header>

<!-- Ø§Ù„ØªÙ†Ù‚Ù„ -->
<nav>
  <button onclick="showSection('clinic')">ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ù„Ø©</button>
  <button onclick="showSection('driver')">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ù„</button>
  <button onclick="showSection('assistant')">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
  <button onclick="showSection('assign')">ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ</button>
  <button onclick="showSection('tech')">Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ</button>
  <button onclick="showSection('deliver')">Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</button>
  <button onclick="showSection('returned')">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø§Ø¬Ø¹Ø©</button>
  <button onclick="showSection('xray')">Ø§Ù„Ø£Ø´Ø¹Ø© (R4)</button>
  <button onclick="showSection('stats')">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
</nav>

<!-- â–‘â–‘â–‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© â–‘â–‘â–‘ -->
<div class="section" id="clinic">
<h2>ğŸ“‹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</h2>

<label>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù (MRN)</label>
<input id="mrn">

<label>Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</label>
<input id="pname">

<label>Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨</label>
<input id="dname">

<label>Ø±Ù‚Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</label>
<input id="cnum">

<label>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„Ø©</label>
<select id="ctype">
<option>TM</option><option>CD</option><option>RPD</option>
<option>PFM</option><option>Ortho</option><option>Resin</option>
</select>

<label>Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</label>
<select id="deps" multiple>
<option>TM</option><option>CD</option><option>RPD</option>
<option>PFM</option><option>Ortho</option><option>Resin</option>
</select>

<label>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø±ÙŠØ¶ Ø§Ù„Ù‚Ø§Ø¯Ù…</label>
<input type="date" id="nextDate">

<button class="action" onclick="saveCase()">âœ” Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø©</button>

<div id="qrBox"></div>
</div>

<!-- â–‘â–‘â–‘ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ â–‘â–‘â–‘ -->
<div class="section" id="driver">
<h2>ğŸšš Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ù„</h2>
<label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„</label>
<input id="driverLab">
<button class="action" onclick="setStatus('DriverReceived', driverLab)">âœ” ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</button>
</div>

<!-- â–‘â–‘â–‘ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© â–‘â–‘â–‘ -->
<div class="section" id="assistant">
<h2>ğŸ§• Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ø¹Ù…Ù„</h2>
<label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„</label>
<input id="assLab">
<button class="action" onclick="setStatus('AssistantReceived', assLab)">âœ” ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</button>
</div>

<!-- â–‘â–‘â–‘ ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ â–‘â–‘â–‘ -->
<div class="section" id="assign">
<h2>ğŸ›  ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙÙ†ÙŠ</h2>
<label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„</label>
<input id="assignLab">

<label>Ø§Ø®ØªØ± Ø§Ù„ÙÙ†ÙŠ</label>
<select id="techName">
<option>ÙÙ‡Ø¯ (TM)</option>
<option>Ø£Ø­Ù…Ø¯ (RPD)</option>
<option>Ø±ÙŠØ§Ø¶ (CD)</option>
</select>

<button class="action" onclick="assignTech()">ğŸ“Œ ØªØ­ÙˆÙŠÙ„ Ù„Ù„ÙÙ†ÙŠ</button>
</div>

<!-- â–‘â–‘â–‘ Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ â–‘â–‘â–‘ -->
<div class="section" id="tech">
<h2>ğŸ§‘â€ğŸ”§ Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ</h2>

<label>Ø§Ø®ØªØ± Ø§Ù„ÙÙ†ÙŠ</label>
<select id="techFilter">
<option>ÙÙ‡Ø¯ (TM)</option><option>Ø£Ø­Ù…Ø¯ (RPD)</option><option>Ø±ÙŠØ§Ø¶ (CD)</option>
</select>

<button class="action" onclick="loadTechCases()">ğŸ“‚ Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª</button>
<div id="techList"></div>
</div>

<!-- â–‘â–‘â–‘ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ â–‘â–‘â–‘ -->
<div class="section" id="deliver">
<h2>ğŸ“¦ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h2>
<label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„</label>
<input id="deliLab">
<button class="action" onclick="setStatus('Delivered', deliLab)">âœ” ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©</button>
</div>

<!-- â–‘â–‘â–‘ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© â–‘â–‘â–‘ -->
<div class="section" id="returned">
<h2>ğŸ” Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø§Ø¬Ø¹Ø©</h2>
<div id="returnedList"></div>
</div>

<!-- â–‘â–‘â–‘ ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø´Ø¹Ø© â–‘â–‘â–‘ -->
<div class="section" id="xray">
<h2>ğŸ¦· Ø¢Ø®Ø± Ø£Ø´Ø¹Ø© Ù…Ù† R4</h2>

<label>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù (MRN)</label>
<input id="xmrn">

<button class="action" onclick="fetchXray()">ğŸ“¥ Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø£Ø´Ø¹Ø©</button>

<div id="xrayResult" style="margin-top:20px;"></div>
</div>

<!-- â–‘â–‘â–‘ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª â–‘â–‘â–‘ -->
<div class="section" id="stats">
<h2>ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
<div id="statsData"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
function showSection(id){
  document.querySelectorAll('.section').forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

/* Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª */
function getDB(){ return JSON.parse(localStorage.getItem("cases")||"[]"); }
function saveDB(db){ localStorage.setItem("cases", JSON.stringify(db)); }

/* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© */
function saveCase(){
  let db=getDB();
  let id="DSA-"+Date.now();

  db.push({
    lab:id,
    mrn:mrn.value,
    pname:pname.value,
    dname:dname.value,
    clinic:cnum.value,
    type:ctype.value,
    depts:Array.from(deps.selectedOptions).map(o=>o.value),
    next:nextDate.value,
    tech:null,
    status:"New",
    history:[{step:"ClinicEntry", time:new Date().toLocaleString()}]
  });

  saveDB(db);

  qrBox.innerHTML="";
  new QRCode(qrBox,id);

  alert("âœ” ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø±Ù‚Ù…: "+id);
}

/* ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© */
function setStatus(status, input){
  let id=input.value;
  let db=getDB();
  db.forEach(c=>{
    if(c.lab===id){
      c.status=status;
      c.history.push({step:status, time:new Date().toLocaleString()});
    }
  });
  saveDB(db);
  alert("âœ” ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«");
}

/* ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ */
function assignTech(){
  let id=assignLab.value;
  let tech=techName.value;
  let db=getDB();
  db.forEach(c=>{
    if(c.lab===id){
      c.tech=tech;
      c.status="WithTech";
      c.history.push({step:"Assigned "+tech, time:new Date().toLocaleString()});
    }
  });
  saveDB(db);
  alert("âœ” ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„ÙÙ†ÙŠ");
}

/* Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ */
function loadTechCases(){
  let tech=techFilter.value;
  let db=getDB();
  let list=db.filter(c=>c.tech===tech);
  let html="";

  list.forEach(c=>{
    html+=`
    <div class='case-card'>
      <b>${c.lab}</b> â€” ${c.pname}<br>
      Ø§Ù„Ù‚Ø³Ù…: ${c.type}<br>
      <button onclick="completeCase('${c.lab}')">âœ” Ø¥Ù†Ù‡Ø§Ø¡</button>
      <button onclick="returnCase('${c.lab}')">ğŸ” Ø¥Ø±Ø¬Ø§Ø¹</button>
    </div>`;
  });

  techList.innerHTML=html;
}

/* Ø¥Ù†Ù‡Ø§Ø¡ ÙÙ†ÙŠ */
function completeCase(id){
  let db=getDB();
  db.forEach(c=>{
    if(c.lab===id){
      c.status="Completed";
      c.history.push({step:"Completed", time:new Date().toLocaleString()});
    }
  });
  saveDB(db);
  alert("âœ” ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„Ø©");
}

/* Ø¥Ø±Ø¬Ø§Ø¹ */
function returnCase(id){
  let db=getDB();
  db.forEach(c=>{
    if(c.lab===id){
      c.status="Returned";
      c.history.push({step:"Returned", time:new Date().toLocaleString()});
    }
  });
  saveDB(db);
  alert("ğŸ” ØªÙ… Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø§Ù„Ø©");
  loadReturned();
}

/* Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© */
function loadReturned(){
  let db=getDB();
  let list=db.filter(c=>c.status==="Returned");
  let html="";
  list.forEach(c=>{
    html+=`<div class='case-card'><b>${c.lab}</b> â€” ${c.pname}</div>`;
  });
  returnedList.innerHTML=html;
}
loadReturned();

/* Ø§Ù„Ø£Ø´Ø¹Ø© (R4 Placeholder) */
function fetchXray(){
  // Ø¥Ù„Ù‰ Ø£Ù† ÙŠØ³Ù…Ø­ IT â€” Ù‡Ø°Ø§ Ù†Ù…ÙˆØ°Ø¬ ÙÙ‚Ø·
  xrayResult.innerHTML=
  `<h3>ğŸ”§ Ø§Ù„Ø±Ø¨Ø· Ø¬Ø§Ù‡Ø² â€“ Ù†Ù†ØªØ¸Ø± Ù…ÙˆØ§ÙÙ‚Ø© IT</h3>
   <p>MRN: ${xmrn.value}</p>
   <img src="https://via.placeholder.com/300x200?text=Latest+X-Ray" style="border-radius:10px;">`;
}

/* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
function showStats(){
  let db=getDB();
  let html=`
    Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª: ${db.length}<br>
    Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ${db.filter(c=>c.status==="New").length}<br>
    Ø¹Ù†Ø¯ Ø§Ù„ÙÙ†ÙŠ: ${db.filter(c=>c.status==="WithTech").length}<br>
    Ù…ÙƒØªÙ…Ù„Ø©: ${db.filter(c=>c.status==="Completed").length}<br>
    Ø§Ù„Ø±Ø§Ø¬Ø¹Ø©: ${db.filter(c=>c.status==="Returned").length}<br>
    Ø§Ù„Ù…Ø³Ù„Ù…Ø©: ${db.filter(c=>c.status==="Delivered").length}<br>
  `;
  statsData.innerHTML=html;
}
showStats();
</script>

</body>
</html><!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>DSA Lab â€“ Wedad Aljabari</title>

<style>
:root{
  --primary:#14532d;      /* Ø£Ø®Ø¶Ø± ØºØ§Ù…Ù‚ (Ù„ÙˆÙ†Ùƒ Ø§Ù„Ù…ÙØ¶Ù„) */
  --primary-soft:#15803d; /* Ø£Ø®Ø¶Ø± Ø£ÙØªØ­ */
  --bg:#f4f4f5;
  --card:#ffffff;
  --accent:#020617;       /* Ø£Ø³ÙˆØ¯ Ù†Ø§Ø¹Ù… */
}
*{box-sizing:border-box;}
body{
  font-family:"Tahoma",system-ui;
  background:var(--bg);
  margin:0;
  padding:0;
}

/* Header */
header{
  background:linear-gradient(135deg,var(--primary),#000000);
  color:white;
  padding:16px 20px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
header .title{
  font-size:20px;
  font-weight:bold;
}
header .subtitle{
  font-size:12px;
  opacity:0.8;
}
header .brand{
  text-align:right;
  font-size:12px;
}

/* Nav */
nav{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  background:#fff;
  padding:10px;
  border-bottom:1px solid #e5e7eb;
}
nav button{
  flex:1;
  min-width:120px;
  padding:8px 10px;
  border-radius:999px;
  border:1px solid #e5e7eb;
  background:#f9fafb;
  cursor:pointer;
  font-weight:bold;
  font-size:13px;
}
nav button.active{
  background:var(--primary);
  color:white;
  border-color:var(--primary);
}

/* Layout */
.main{
  max-width:1024px;
  margin:15px auto 40px auto;
  padding:0 10px;
}
.section{
  display:none;
  background:var(--card);
  border-radius:16px;
  padding:18px;
  box-shadow:0 4px 14px rgba(15,23,42,0.08);
  margin-bottom:18px;
}
.section h2{
  margin-top:0;
  font-size:18px;
  margin-bottom:8px;
}
.section small{
  color:#6b7280;
}

/* Forms */
label{
  display:block;
  margin-top:10px;
  font-weight:bold;
  font-size:13px;
}
input,select,textarea{
  width:100%;
  padding:9px 10px;
  margin-top:4px;
  border-radius:10px;
  border:1px solid #d4d4d8;
  font-size:13px;
  background:#f9fafb;
}
textarea{min-height:80px; resize:vertical;}
button.action{
  width:100%;
  margin-top:14px;
  padding:11px;
  border-radius:999px;
  border:none;
  background:var(--primary-soft);
  color:white;
  font-size:14px;
  font-weight:bold;
  cursor:pointer;
}
button.action:hover{background:#166534;}

.case-card{
  background:#f9fafb;
  border-radius:12px;
  border:1px solid #e5e7eb;
  padding:10px;
  margin-top:8px;
  font-size:13px;
}
.case-card b{color:var(--accent);}
.case-card button{
  margin-top:6px;
  margin-inline-end:4px;
  padding:5px 8px;
  font-size:11px;
  border-radius:999px;
  border:none;
  cursor:pointer;
}
.case-card .done{background:#16a34a;color:white;}
.case-card .ret{background:#f97316;color:white;}

#qrBox{text-align:center;margin-top:16px;}
#qrBox canvas{border-radius:10px;border:1px solid #e5e7eb;padding:6px;background:white;}

footer{
  text-align:center;
  font-size:11px;
  color:#6b7280;
  padding:10px 0 18px 0;
}

/* Login overlay */
#loginOverlay{
  position:fixed;
  inset:0;
  background:linear-gradient(135deg,#000000,#14532d);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:1000;
}
.login-card{
  width:320px;
  background:#f9fafb;
  border-radius:20px;
  padding:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.4);
  text-align:center;
}
.login-card h1{
  margin:0 0 4px 0;
  font-size:20px;
}
.login-card p{
  margin:0 0 10px 0;
  font-size:12px;
  color:#6b7280;
}
.login-card input{
  background:#ffffff;
}
.role-pill{
  font-size:11px;
  background:#e5e7eb;
  border-radius:999px;
  padding:4px 8px;
  display:inline-block;
  margin-top:4px;
}
.badge-user{
  font-size:11px;
  background:#bbf7d0;
  color:#14532d;
  padding:2px 6px;
  border-radius:999px;
  margin-right:4px;
}
</style>
</head>

<body>

<!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginOverlay">
  <div class="login-card">
    <h1>DSA Lab</h1>
    <p>Ù†Ø¸Ø§Ù… Ù…Ø¹Ù…Ù„ Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø®Ø§Øµ Ø¨Ù€ <b>ÙˆØ¯Ø§Ø¯ Ø§Ù„Ø¬Ø¨Ø§Ø±ÙŠ</b></p>
    <div class="role-pill">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>

    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
    <input id="loginUser" placeholder="Ù…Ø«Ø§Ù„: wedad / assistant / tech / driver"/>

    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
    <input id="loginPass" type="password" placeholder="â€¢â€¢â€¢â€¢"/>

    <button class="action" onclick="doLogin()">Ø¯Ø®ÙˆÙ„</button>

    <div style="text-align:right;margin-top:10px;font-size:11px;color:#6b7280;">
      ØªØ¬Ø±ÙŠØ¨ÙŠÙ‹Ø§:<br>
      <span class="badge-user">wedad / 1234</span> (Ø£Ø¯Ù…Ù†)<br>
      <span class="badge-user">assistant / 1111</span> (Ù…Ø³Ø§Ø¹Ø¯Ø©)<br>
      <span class="badge-user">driver / 2222</span> (Ø¹Ø§Ù…Ù„)<br>
      <span class="badge-user">tech / 3333</span> (ÙÙ†ÙŠ)
    </div>
  </div>
</div>

<header>
  <div>
    <div class="title">Ù†Ø¸Ø§Ù… Ù…Ø¹Ù…Ù„ Ø§Ù„Ø£Ø³Ù†Ø§Ù† â€“ DSA Lab</div>
    <div class="subtitle">Ø¥Ø¯Ø§Ø±Ø© Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØªØ³Ù„ÙŠÙ… â€“ Ù†Ø³Ø®Ø© Ù…Ø®ØµØµØ© Ù„ÙˆØ¯Ø§Ø¯</div>
  </div>
  <div class="brand">
    Developed for<br>
    <b>Wedad Aljabari</b>
  </div>
</header>

<nav id="mainNav" style="display:none;">
  <button data-sec="clinic" class="active">ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ù„Ø©</button>
  <button data-sec="driver">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ù„</button>
  <button data-sec="assistant">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
  <button data-sec="assign">ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ</button>
  <button data-sec="tech">Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ</button>
  <button data-sec="deliver">Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</button>
  <button data-sec="returned">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø§Ø¬Ø¹Ø©</button>
  <button data-sec="xray">Ø§Ù„Ø£Ø´Ø¹Ø© (R4)</button>
  <button data-sec="stats">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
</nav>

<div class="main">

  <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© -->
  <section class="section" id="clinic">
    <h2>ğŸ“‹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</h2>
    <small>Ù‡Ø°Ù‡ Ø¨Ø¯Ø§ÙŠØ© ÙƒÙ„ Ø­Ø±ÙƒØ©ØŒ Ù…Ù† Ù‡Ù†Ø§ ÙŠØ¨Ø¯Ø£ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ ÙˆØ§Ù„Ù€ QR.</small>

    <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù (MRN)</label>
    <input id="mrn">

    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</label>
    <input id="pname">

    <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨</label>
    <input id="dname">

    <label>Ø±Ù‚Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</label>
    <input id="cnum">

    <label>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„Ø©</label>
    <select id="ctype">
      <option>TM</option><option>CD</option><option>RPD</option>
      <option>PFM</option><option>Ortho</option><option>Resin</option>
    </select>

    <label>Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</label>
    <select id="deps" multiple>
      <option>TM</option><option>CD</option><option>RPD</option>
      <option>PFM</option><option>Ortho</option><option>Resin</option>
    </select>

    <label>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø±ÙŠØ¶ Ø§Ù„Ù‚Ø§Ø¯Ù…</label>
    <input type="date" id="nextDate">

    <button class="action" onclick="saveCase()">âœ” Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø±Ù‚Ù… Ù…Ø¹Ù…Ù„</button>

    <div id="qrBox"></div>
  </section>

  <!-- Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ -->
  <section class="section" id="driver">
    <h2>ğŸšš Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</h2>
    <small>Ø§Ù„Ø¹Ø§Ù…Ù„ ÙŠÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ Ø£Ùˆ ÙŠÙ…Ø³Ø­ Ø§Ù„Ù€ QR.</small>
    <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ (Lab ID)</label>
    <input id="driverLab">
    <button class="action" onclick="setStatus('DriverReceived', driverLab)">âœ” ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</button>
  </section>

  <!-- Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© -->
  <section class="section" id="assistant">
    <h2>ğŸ§• Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ø¹Ù…Ù„</h2>
    <small>Ù‡Ù†Ø§ ØªØ«Ø¨Ù‘ØªÙŠÙ† Ø£Ù† Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØµÙ„Øª Ù„Ù„Ù…Ø¹Ù…Ù„ Ø±Ø³Ù…ÙŠÙ‹Ø§.</small>
    <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ (Lab ID)</label>
    <input id="assLab">
    <button class="action" onclick="setStatus('AssistantReceived', assLab)">âœ” ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ù…Ø¹Ù…Ù„</button>
  </section>

  <!-- ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ -->
  <section class="section" id="assign">
    <h2>ğŸ›  ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙÙ†ÙŠ</h2>
    <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ (Lab ID)</label>
    <input id="assignLab">

    <label>Ø§Ø®ØªØ± Ø§Ù„ÙÙ†ÙŠ</label>
    <select id="techName">
      <option>ÙÙ‡Ø¯ (TM)</option>
      <option>Ø£Ø­Ù…Ø¯ (RPD)</option>
      <option>Ø±ÙŠØ§Ø¶ (CD)</option>
    </select>

    <button class="action" onclick="assignTech()">ğŸ“Œ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù„ÙÙ†ÙŠ</button>
  </section>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ -->
  <section class="section" id="tech">
    <h2>ğŸ§‘â€ğŸ”§ Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ</h2>
    <label>Ø§Ø®ØªØ± Ø§Ù„ÙÙ†ÙŠ</label>
    <select id="techFilter">
      <option>ÙÙ‡Ø¯ (TM)</option><option>Ø£Ø­Ù…Ø¯ (RPD)</option><option>Ø±ÙŠØ§Ø¶ (CD)</option>
    </select>
    <button class="action" onclick="loadTechCases()">ğŸ“‚ Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ù„Ù„ÙÙ†ÙŠ</button>
    <div id="techList"></div>
  </section>

  <!-- Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ -->
  <section class="section" id="deliver">
    <h2>ğŸ“¦ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©</h2>
    <small>Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙÙ†ÙŠ ÙˆÙ…Ø±Ø§Ø¬Ø¹ØªÙƒØŒ ØªØ³Ø¬Ù„ÙŠÙ† Ù‡Ù†Ø§ Ø£Ù† Ø§Ù„Ø­Ø§Ù„Ø© Ø®Ø±Ø¬Øª Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©.</small>
    <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ (Lab ID)</label>
    <input id="deliLab">
    <button class="action" onclick="setStatus('Delivered', deliLab)">âœ” ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©</button>
  </section>

  <!-- Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© -->
  <section class="section" id="returned">
    <h2>ğŸ” Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© (ØªØ¹Ø¯ÙŠÙ„/Ù…Ù„Ø§Ø­Ø¸Ø©)</h2>
    <div id="returnedList"></div>
  </section>

  <!-- Ø§Ù„Ø£Ø´Ø¹Ø© -->
  <section class="section" id="xray">
    <h2>ğŸ¦· ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø´Ø¹Ø© (R4)</h2>
    <small>Ù‡Ø°Ù‡ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø±Ø¨Ø· Ù…Ø¹ R4 Ø¹Ù† Ø·Ø±ÙŠÙ‚ IT (Ø­Ø§Ù„ÙŠÙ‹Ø§ Ù…Ø«Ø§Ù„ ÙÙ‚Ø·).</small>
    <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù (MRN)</label>
    <input id="xmrn">
    <button class="action" onclick="fetchXray()">ğŸ“¥ Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø£Ø´Ø¹Ø©</button>
    <div id="xrayResult" style="margin-top:16px;"></div>
  </section>

  <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
  <section class="section" id="stats">
    <h2>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø© Ù„Ù„Ø­Ø§Ù„Ø§Øª</h2>
    <div id="statsData"></div>
  </section>

</div>

<footer>
  Â© Ù†Ø¸Ø§Ù… Ù…Ø¹Ù…Ù„ Ø§Ù„Ø£Ø³Ù†Ø§Ù† DSA â€“ ØªØµÙ…ÙŠÙ… Ø®Ø§Øµ Ù„Ù€ <b>Wedad Aljabari</b> â€“ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ ÙÙ‚Ø·
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
/* ---------------- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ---------------- */
const users = [
  {user:"wedad", pass:"1234", role:"admin"},
  {user:"assistant", pass:"1111", role:"assistant"},
  {user:"driver", pass:"2222", role:"driver"},
  {user:"tech", pass:"3333", role:"tech"}
];
let currentUser = null;

function doLogin(){
  const u = loginUser.value.trim();
  const p = loginPass.value.trim();
  const found = users.find(x => x.user === u && x.pass === p);
  if(!found){
    alert("âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    return;
  }
  currentUser = found;
  loginOverlay.style.display = "none";
  mainNav.style.display = "flex";
  applyRolePermissions();
  showSection("clinic"); // Ø§ÙØªØ±Ø§Ø¶ÙŠ
}

function applyRolePermissions(){
  // Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
  const role = currentUser.role;
  document.querySelectorAll("nav button").forEach(btn => {
    const sec = btn.getAttribute("data-sec");
    let show = false;
    if(role === "admin"){
      show = true; // ÙƒÙ„ Ø´ÙŠØ¡
    }else if(role === "assistant"){
      show = ["clinic","assistant","assign","returned","stats","xray"].includes(sec);
    }else if(role === "driver"){
      show = ["driver","stats"].includes(sec);
    }else if(role === "tech"){
      show = ["tech","xray","stats"].includes(sec);
    }
    btn.style.display = show ? "inline-block" : "none";
  });
}

/* ---------------- ØªÙ†Ù‚Ù„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ---------------- */
document.querySelectorAll("nav button").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    showSection(btn.getAttribute("data-sec"));
  });
});

function showSection(id){
  document.querySelectorAll(".section").forEach(s=>s.style.display="none");
  const sec = document.getElementById(id);
  if(sec) sec.style.display="block";
}

/* ---------------- Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù…Ø­Ù„ÙŠØ©) ---------------- */
function getDB(){return JSON.parse(localStorage.getItem("cases")||"[]");}
function saveDB(db){localStorage.setItem("cases",JSON.stringify(db));}

/* ---------------- ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ---------------- */
function saveCase(){
  let db = getDB();
  const id = "DSA-" + Date.now();

  const newCase = {
    lab:id,
    mrn:mrn.value,
    pname:pname.value,
    dname:dname.value,
    clinic:cnum.value,
    type:ctype.value,
    depts:Array.from(deps.selectedOptions).map(o=>o.value),
    next:nextDate.value,
    tech:null,
    status:"New",
    history:[{step:"ClinicEntry",by:currentUser?.user || "assistant",time:new Date().toLocaleString()}]
  };
  db.push(newCase);
  saveDB(db);

  qrBox.innerHTML="";
  new QRCode(qrBox,id);

  alert("âœ” ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ø±Ù‚Ù… Ù…Ø¹Ù…Ù„: "+id);
  showStats();
}

/* ---------------- ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø¹Ø§Ù…Ø© ---------------- */
function setStatus(status, inputEl){
  const id = inputEl.value.trim();
  if(!id){alert("Ø£Ø¯Ø®Ù„ÙŠ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ Ø£ÙˆÙ„Ø§Ù‹");return;}
  let db = getDB();
  let found = false;
  db = db.map(c=>{
    if(c.lab === id){
      c.status = status;
      c.history.push({step:status,by:currentUser?.user || "system",time:new Date().toLocaleString()});
      found = true;
    }
    return c;
  });
  if(!found){
    alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…");
    return;
  }
  saveDB(db);
  alert("âœ” ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© "+id);
  loadReturned();
  showStats();
}

/* ---------------- ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ ---------------- */
function assignTech(){
  const id = assignLab.value.trim();
  const tech = techName.value;
  if(!id){alert("Ø£Ø¯Ø®Ù„ÙŠ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„");return;}

  let db = getDB();
  let found = false;
  db = db.map(c=>{
    if(c.lab === id){
      c.tech = tech;
      c.status = "WithTech";
      c.history.push({step:"AssignTech:"+tech,by:currentUser?.user || "assistant",time:new Date().toLocaleString()});
      found = true;
    }
    return c;
  });
  if(!found){alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø©");return;}
  saveDB(db);
  alert("âœ” ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù„ÙÙ†ÙŠ");
  showStats();
}

/* ---------------- Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ ---------------- */
function loadTechCases(){
  const tech = techFilter.value;
  const db = getDB();
  const list = db.filter(c=>c.tech === tech);
  let html = "";
  list.forEach(c=>{
    html += `
      <div class="case-card">
        <b>${c.lab}</b> â€” ${c.pname || "Ù…Ø±ÙŠØ¶"}<br>
        Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„Ø©: ${c.type}<br>
        Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${c.status}<br>
        <button class="done" onclick="completeCase('${c.lab}')">âœ” Ø¥Ù†Ù‡Ø§Ø¡</button>
        <button class="ret" onclick="returnCase('${c.lab}')">ğŸ” Ø¥Ø±Ø¬Ø§Ø¹</button>
      </div>
    `;
  });
  techList.innerHTML = html || "<small>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ÙÙ†ÙŠ Ø­Ø§Ù„ÙŠØ§Ù‹.</small>";
}

/* Ø¥Ù†Ù‡Ø§Ø¡ ÙÙ†ÙŠ */
function completeCase(id){
  let db = getDB();
  db = db.map(c=>{
    if(c.lab === id){
      c.status = "Completed";
      c.history.push({step:"Completed",by:currentUser?.user || "tech",time:new Date().toLocaleString()});
    }
    return c;
  });
  saveDB(db);
  alert("âœ” ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„Ø©");
  loadTechCases();
  showStats();
}

/* Ø¥Ø±Ø¬Ø§Ø¹ */
function returnCase(id){
  let db = getDB();
  db = db.map(c=>{
    if(c.lab === id){
      c.status = "Returned";
      c.history.push({step:"Returned",by:currentUser?.user || "tech",time:new Date().toLocaleString()});
    }
    return c;
  });
  saveDB(db);
  alert("ğŸ” ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© ÙƒÙ€ (Ø±Ø§Ø¬Ø¹Ø©)");
  loadTechCases();
  loadReturned();
  showStats();
}

/* Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© */
function loadReturned(){
  const db = getDB();
  const list = db.filter(c=>c.status === "Returned");
  let html = "";
  list.forEach(c=>{
    html += `<div class="case-card"><b>${c.lab}</b> â€” ${c.pname || ""} | Ù†ÙˆØ¹: ${c.type}</div>`;
  });
  returnedList.innerHTML = html || "<small>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ø±Ø§Ø¬Ø¹Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</small>";
}

/* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø´Ø¹Ø© â€“ Placeholder Ù„Ø±Ø¨Ø· R4 */
function fetchXray(){
  xrayResult.innerHTML = `
    <div class="case-card">
      <b>MRN:</b> ${xmrn.value || "ØºÙŠØ± Ù…Ø¯Ø®Ù„"}<br>
      Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø±Ø¨Ø· Ù…Ø¹ Ù†Ø¸Ø§Ù… R4 Ø¹Ø¨Ø± ÙØ±ÙŠÙ‚ Ø§Ù„Ù€ IT (API / ODBC).<br>
      <br>
      <img src="https://via.placeholder.com/320x200?text=Latest+X-Ray+Preview"
           alt="X-Ray preview" style="width:100%;border-radius:10px;border:1px solid #e5e7eb;">
      <br><small>ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ© Ø³ÙŠØªÙ… Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø£Ø´Ø¹Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† R4 Ùˆ Ø¹Ø±Ø¶Ù‡Ø§ Ù‡Ù†Ø§ Ù„Ù„ÙÙ†ÙŠ.</small>
    </div>
  `;
}

/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
function showStats(){
  const db = getDB();
  const total = db.length;
  const count = st => db.filter(c=>c.status === st).length;
  const html = `
    <div class="case-card">
      Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª: <b>${total}</b><br>
      Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©: ${count("New")}<br>
      Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ø§Ù…Ù„: ${count("DriverReceived")}<br>
      ÙÙŠ Ø§Ù„Ù…Ø¹Ù…Ù„ (Ø§Ø³ØªÙ„Ø§Ù… Ù…Ø³Ø§Ø¹Ø¯Ø©): ${count("AssistantReceived")}<br>
      Ø¹Ù†Ø¯ Ø§Ù„ÙÙ†ÙŠ: ${count("WithTech")}<br>
      Ù…ÙƒØªÙ…Ù„Ø© Ù…Ù† Ø§Ù„ÙÙ†ÙŠ: ${count("Completed")}<br>
      Ø±Ø§Ø¬Ø¹Ø© (ØªØ¹Ø¯ÙŠÙ„): ${count("Returned")}<br>
      Ù…Ø³Ù„Ù‘Ù…Ø© Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©: ${count("Delivered")}<br>
    </div>
  `;
  statsData.innerHTML = html;
}
showStats();
loadReturned();
</script>

</body>
</html>const messages = [
"Ø§Ù„ÙŠÙˆÙ… ÙŠÙˆÙ…Ùƒâ€¦ Ø±ÙƒÙ‘Ø²ÙŠ ÙˆØ§Ù†Ø·Ù„Ù‚ÙŠ ğŸ¤",
"Ø®Ø·ÙˆØ© ØµØºÙŠØ±Ø© Ø§Ù„ÙŠÙˆÙ… = Ø¥Ù†Ø¬Ø§Ø² ÙƒØ¨ÙŠØ± Ø¨ÙƒØ±Ø© âœ¨",
"Ø«Ù‚ØªÙƒ Ø¨Ù†ÙØ³Ùƒ Ù‡ÙŠ Ø£Ø³Ø§Ø³ Ù†Ø¬Ø§Ø­ Ø´ØºÙ„Ùƒ.",
"ÙˆØ¯Ø§Ø¯ ÙˆØ§Ù„ÙØ±ÙŠÙ‚â€¦ Ø£Ù†ØªÙ… ØªØµÙ†Ø¹ÙˆÙ† ÙØ±Ù‚ â™¥ï¸",
"Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø§ÙŠØ© Ø¨ØªÙƒÙˆÙ† Ø£Ø³Ù‡Ù„ Ù…Ù† Ø§Ù„Ù„ÙŠ Ù‚Ø¨Ù„Ù‡Ø§!",
"ØªØ±ÙƒÙŠØ² + Ù†ÙŠØ© Ø·ÙŠØ¨Ø© = Ø´ØºÙ„ Ù…Ø±ØªØ¨ ğŸ™",
"ÙƒÙ„ Ø­Ø§Ù„Ø© ØªØ³Ù„Ù‘Ù… = Ø¥Ù†Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯ Ù„Ùƒ ğŸ’ª",
"Ø§Ù„ÙŠÙˆÙ… Ø£ÙØ¶Ù„ Ù…Ù† Ø£Ù…Ø³â€¦ Ø¯Ø§Ù…Ùƒ Ù…Ø³ØªÙ…Ø±Ø©.",
"Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙƒâ€¦ Ø´ØºÙ„Ùƒ ÙˆØ§Ø¶Ø­!",
"Ù‚ÙˆØ© Ø§Ù„Ø´ØºÙ„ Ù…Ù† Ù‚ÙˆØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„ âœ¨",
"Ø§Ù†ØªÙ Ù‚Ø¯Ù‘Ù‡Ø§ Ø¯Ø§ÙŠÙ… ÙŠØ§ ÙˆØ¯Ø§Ø¯ â™¥ï¸",
"ÙƒÙ„ Ø­Ø§Ù„Ø© ØªÙ…Ø±Ù‘ Ù…Ù† ÙŠØ¯Ùƒâ€¦ ØªØªØ±Ùƒ Ø¨ØµÙ…Ø©.",
"Ù†ØªØ¹Ù„Ù…ØŒ Ù†ØªØ·ÙˆØ±ØŒ ÙˆÙ†ÙƒØ¨Ø± ÙƒÙ„ ÙŠÙˆÙ….",
"Ø§Ø¨ØªØ³Ù…ÙŠâ€¦ ØªØ±Ø§ Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ ØªØªÙƒÙ„Ù… ğŸŒŸ",
"Ø§Ù„ØªØ±ØªÙŠØ¨ Ù†ØµÙ Ø§Ù„Ù†Ø¬Ø§Ø­!",
"Ø§Ù„Ù„Ù‡ ÙŠØ¹Ø·ÙŠÙƒ Ø§Ù„Ø¹Ø§ÙÙŠØ©â€¦ Ø§Ø³ØªÙ…Ø±ÙŠ.",
"Ù‚Ù„ÙŠÙ„ Ù…Ø³ØªÙ…Ø±â€¦ Ø®ÙŠØ± Ù…Ù† ÙƒØ«ÙŠØ± Ù…Ù†Ù‚Ø·Ø¹.",
"Ø§Ø¨Ø¯Ø£ÙŠ Ø§Ù„Ø¢Ù†â€¦ ÙˆÙ„Ùˆ Ø¨Ø®Ø·ÙˆØ© Ø¨Ø³ÙŠØ·Ø©.",
"ØªØ±Ù‰ Ø§Ù„ØªØ¹Ø¨ ÙŠØ±ÙˆØ­â€¦ Ø¨Ø³ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² ÙŠØ¨Ù‚Ù‰.",
"Ø£Ù†ØªÙ ÙØ®Ø± Ø§Ù„Ù…Ø¹Ù…Ù„ ÙŠØ§ ÙˆØ¯Ø§Ø¯ âœ¨",
"Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡â€¦ Ù†Ø¨Ø¯Ø£ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø§Ù„ÙŠÙˆÙ… ğŸ¤",
"ÙƒÙ„ Ù‚Ø³Ù… ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„ÙŠÙƒâ€¦ ÙˆØ§Ù†ØªÙ Ù‚Ø¯Ù‡Ø§.",
"Ø§Ù„Ù…Ø¹Ø§Ù…Ù„ ØªØ±ØªÙ‚ÙŠ Ø¨Ù†Ø¸Ø§Ù…â€¦ ÙˆØ§Ù†ØªÙŠ Ø³ÙˆÙŠØªÙŠÙ‡!",
"Ù‚Ù„Ø¨Ùƒ Ø§Ù„Ø·ÙŠØ¨ ÙŠÙ†Ø¹ÙƒØ³ Ø¹Ù„Ù‰ Ø´ØºÙ„Ùƒ Ø¯Ø§Ø¦Ù…Ù‹Ø§.",
"Ø´ØºÙ„Ùƒ Ù…Ùˆ Ø¨Ø³ Ø¹Ù…Ù„â€¦ Ø¨ØµÙ…Ø© â™¥ï¸",
"Ø£Ù†ØªÙ Ù…Ø´Ø±ÙØ© Ø¨Ù…Ø¹Ù†Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø©.",
"Ø£Ù†ØªÙ ØªØ±ØªØ¨ÙŠÙ† Ø§Ù„Ù…Ø¹Ù…Ù„â€¦ ÙˆØ§Ù„Ù…Ø¹Ù…Ù„ ÙŠØ±ØªÙ‘Ø¨ ÙŠÙˆÙ…Ùƒ.",
"Ø§Ù„ÙÙ†ÙŠÙŠÙ† ÙŠØ¹ØªÙ…Ø¯ÙˆÙ† Ø¹Ù„ÙŠÙƒâ€¦ ÙˆØ£Ù†ØªÙ Ø³Ù†Ø¯Ù‡Ù….",
"Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø¹Ø§Ø¯Ø©â€¦ ÙˆØ§Ù†ØªÙ ØµØ±ØªÙŠ Ø®Ø¨ÙŠØ±Ø© ÙÙŠÙ‡.",
"Ù‚ÙˆØªÙƒ Ø§Ù„Ù‡Ø§Ø¯ÙŠØ© = Ù†Ø¬Ø§Ø­Ùƒ Ø§Ù„Ø¯Ø§Ø¦Ù….",
"ÙƒÙÙˆÙˆÙˆÙˆ ÙŠØ§ ÙˆØ¯Ø§Ø¯! ğŸŒŸ",
"Ø¹ÙŠÙ† Ø§Ù„Ù„Ù‡ ØªØ±Ø¹Ø§Ùƒ ÙÙŠ ÙƒÙ„ Ø®Ø·ÙˆØ©.",
"Ø«Ø§Ø¨Ø±ÙŠâ€¦ ÙØ§Ù„Ø¨Ø¯Ø§ÙŠØ§Øª ØµØ¹Ø¨Ø© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ§Øª Ù…Ø´Ø±Ù‘ÙØ©.",
"Ù…Ø¤Ù…Ù†Ø© Ø¨Ù‚Ø¯Ø±Ø§ØªÙƒØŸ Ø®Ù„ÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… ÙŠØ´ÙˆÙ.",
"ÙƒÙ„ ÙŠÙˆÙ… ØªØªØ·ÙˆØ±ÙŠÙ†â€¦ ÙˆÙ‡Ø°Ø§ ÙƒÙØ§ÙŠØ©.",
"Ù„Ø§ ØªØ´ÙŠÙ„ÙŠÙ† Ù‡Ù…â€¦ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨ÙŠØ³Ù‡Ù‘Ù„ Ø­ÙŠØ§ØªÙƒ.",
"Ø§Ù†Ø·Ù„Ù‚ÙŠ Ø¨Ø«Ù‚Ø©â€¦ Ø§Ù„Ù…Ø¹Ù…Ù„ Ù…Ø¹Ùƒ.",
"Ø§Ù„ÙŠÙˆÙ… Ø£ÙØ¶Ù„ ÙˆÙ‚Øª ØªØ¨Ø¯Ø£ÙŠÙ† ÙÙŠÙ‡.",
"Ø´ØºÙ„Ùƒ ÙŠØ¹ÙƒØ³ Ø´Ø®ØµÙŠØªÙƒâ€¦ ÙˆØ¥Ù†ØªÙ Ø£ØµÙ„Ø§Ù‹ Ø¬Ù…ÙŠÙ„Ø©."
];
/* --------- Ø¹Ø¨Ø§Ø±Ø§Øª ØªØ­ÙÙŠØ²ÙŠÙ‘Ø© ÙŠÙˆÙ…ÙŠØ© --------- */

const messages = [
"Ø§Ù„ÙŠÙˆÙ… ÙŠÙˆÙ…Ùƒâ€¦ Ø±ÙƒÙ‘Ø²ÙŠ ÙˆØ§Ù†Ø·Ù„Ù‚ÙŠ ğŸ¤",
"Ø®Ø·ÙˆØ© ØµØºÙŠØ±Ø© Ø§Ù„ÙŠÙˆÙ… = Ø¥Ù†Ø¬Ø§Ø² ÙƒØ¨ÙŠØ± Ø¨ÙƒØ±Ø© âœ¨",
"Ø«Ù‚ØªÙƒ Ø¨Ù†ÙØ³Ùƒ Ù‡ÙŠ Ø£Ø³Ø§Ø³ Ù†Ø¬Ø§Ø­ Ø´ØºÙ„Ùƒ.",
"ÙˆØ¯Ø§Ø¯ ÙˆØ§Ù„ÙØ±ÙŠÙ‚â€¦ Ø£Ù†ØªÙ… ØªØµÙ†Ø¹ÙˆÙ† ÙØ±Ù‚ â™¥ï¸",
"Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø§ÙŠØ© Ø¨ØªÙƒÙˆÙ† Ø£Ø³Ù‡Ù„ Ù…Ù† Ø§Ù„Ù„ÙŠ Ù‚Ø¨Ù„Ù‡Ø§!",
"ØªØ±ÙƒÙŠØ² + Ù†ÙŠØ© Ø·ÙŠØ¨Ø© = Ø´ØºÙ„ Ù…Ø±ØªØ¨ ğŸ™",
"ÙƒÙ„ Ø­Ø§Ù„Ø© ØªØ³Ù„Ù‘Ù… = Ø¥Ù†Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯ Ù„Ùƒ ğŸ’ª",
"Ø§Ù„ÙŠÙˆÙ… Ø£ÙØ¶Ù„ Ù…Ù† Ø£Ù…Ø³â€¦ Ø¯Ø§Ù…Ùƒ Ù…Ø³ØªÙ…Ø±Ø©.",
"Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙƒâ€¦ Ø´ØºÙ„Ùƒ ÙˆØ§Ø¶Ø­!",
"Ù‚ÙˆØ© Ø§Ù„Ø´ØºÙ„ Ù…Ù† Ù‚ÙˆØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„ âœ¨",
"Ø§Ù†ØªÙ Ù‚Ø¯Ù‘Ù‡Ø§ Ø¯Ø§ÙŠÙ… ÙŠØ§ ÙˆØ¯Ø§Ø¯ â™¥ï¸",
"ÙƒÙ„ Ø­Ø§Ù„Ø© ØªÙ…Ø±Ù‘ Ù…Ù† ÙŠØ¯Ùƒâ€¦ ØªØªØ±Ùƒ Ø¨ØµÙ…Ø©.",
"Ù†ØªØ¹Ù„Ù…ØŒ Ù†ØªØ·ÙˆØ±ØŒ ÙˆÙ†ÙƒØ¨Ø± ÙƒÙ„ ÙŠÙˆÙ….",
"Ø§Ø¨ØªØ³Ù…ÙŠâ€¦ ØªØ±Ø§ Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ ØªØªÙƒÙ„Ù… ğŸŒŸ",
"Ø§Ù„ØªØ±ØªÙŠØ¨ Ù†ØµÙ Ø§Ù„Ù†Ø¬Ø§Ø­!",
"Ø§Ù„Ù„Ù‡ ÙŠØ¹Ø·ÙŠÙƒ Ø§Ù„Ø¹Ø§ÙÙŠØ©â€¦ Ø§Ø³ØªÙ…Ø±ÙŠ.",
"Ù‚Ù„ÙŠÙ„ Ù…Ø³ØªÙ…Ø±â€¦ Ø®ÙŠØ± Ù…Ù† ÙƒØ«ÙŠØ± Ù…Ù†Ù‚Ø·Ø¹.",
"Ø§Ø¨Ø¯Ø£ÙŠ Ø§Ù„Ø¢Ù†â€¦ ÙˆÙ„Ùˆ Ø¨Ø®Ø·ÙˆØ© Ø¨Ø³ÙŠØ·Ø©.",
"ØªØ±Ù‰ Ø§Ù„ØªØ¹Ø¨ ÙŠØ±ÙˆØ­â€¦ Ø¨Ø³ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² ÙŠØ¨Ù‚Ù‰.",
"Ø£Ù†ØªÙ ÙØ®Ø± Ø§Ù„Ù…Ø¹Ù…Ù„ ÙŠØ§ ÙˆØ¯Ø§Ø¯ âœ¨",
"Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡â€¦ Ù†Ø¨Ø¯Ø£ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø§Ù„ÙŠÙˆÙ… ğŸ¤",
"ÙƒÙ„ Ù‚Ø³Ù… ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„ÙŠÙƒâ€¦ ÙˆØ§Ù†ØªÙ Ù‚Ø¯Ù‡Ø§.",
"Ø§Ù„Ù…Ø¹Ø§Ù…Ù„ ØªØ±ØªÙ‚ÙŠ Ø¨Ù†Ø¸Ø§Ù…â€¦ ÙˆØ§Ù†ØªÙŠ Ø³ÙˆÙŠØªÙŠÙ‡!",
"<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>DSA Lab â€“ Workflow System</title>

<style>
:root{
  --primary:#14532d;
  --primary-soft:#15803d;
  --bg:#f4f4f5;
  --card:#ffffff;
  --accent:#020617;
}
*{box-sizing:border-box;}
body{
  font-family:"Tahoma",system-ui;
  background:var(--bg);
  margin:0;
  padding:0;
}

/* Header */
header{
  background:linear-gradient(135deg,var(--primary),#000000);
  color:white;
  padding:16px 20px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
header .title{
  font-size:20px;
  font-weight:bold;
}
header .subtitle{
  font-size:12px;
  opacity:0.8;
}
header .brand{
  text-align:right;
  font-size:12px;
}

/* Nav */
nav{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  background:#fff;
  padding:10px;
  border-bottom:1px solid #e5e7eb;
}
nav button{
  flex:1;
  min-width:120px;
  padding:8px 10px;
  border-radius:999px;
  border:1px solid #e5e7eb;
  background:#f9fafb;
  cursor:pointer;
  font-weight:bold;
  font-size:13px;
}
nav button.active{
  background:var(--primary);
  color:white;
  border-color:var(--primary);
}

/* Layout */
.main{
  max-width:1024px;
  margin:10px auto 40px auto;
  padding:0 10px;
}
.section{
  display:none;
  background:var(--card);
  border-radius:16px;
  padding:18px;
  box-shadow:0 4px 14px rgba(15,23,42,0.08);
  margin-bottom:18px;
}
.section h2{
  margin-top:0;
  font-size:18px;
  margin-bottom:8px;
}
.section small{
  color:#6b7280;
}

/* Forms */
label{
  display:block;
  margin-top:10px;
  font-weight:bold;
  font-size:13px;
}
input,select,textarea{
  width:100%;
  padding:9px 10px;
  margin-top:4px;
  border-radius:10px;
  border:1px solid #d4d4d8;
  font-size:13px;
  background:#f9fafb;
}
textarea{min-height:80px; resize:vertical;}
button.action{
  width:100%;
  margin-top:14px;
  padding:11px;
  border-radius:999px;
  border:none;
  background:var(--primary-soft);
  color:white;
  font-size:14px;
  font-weight:bold;
  cursor:pointer;
}
button.action:hover{background:#166534;}

.case-card{
  background:#f9fafb;
  border-radius:12px;
  border:1px solid #e5e7eb;
  padding:10px;
  margin-top:8px;
  font-size:13px;
}
.case-card b{color:var(--accent);}
.case-card button{
  margin-top:6px;
  margin-inline-end:4px;
  padding:5px 8px;
  font-size:11px;
  border-radius:999px;
  border:none;
  cursor:pointer;
}
.case-card .done{background:#16a34a;color:white;}
.case-card .ret{background:#f97316;color:white;}

#qrBox{text-align:center;margin-top:16px;}
#qrBox canvas{border-radius:10px;border:1px solid #e5e7eb;padding:6px;background:white;}

footer{
  text-align:center;
  font-size:11px;
  color:#6b7280;
  padding:10px 0 18px 0;
}

/* Login overlay */
#loginOverlay{
  position:fixed;
  inset:0;
  background:linear-gradient(135deg,#000000,#14532d);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:1000;
}
.login-card{
  width:320px;
  background:#f9fafb;
  border-radius:20px;
  padding:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.4);
  text-align:center;
}
.login-card h1{
  margin:0 0 4px 0;
  font-size:20px;
}
.login-card p{
  margin:0 0 10px 0;
  font-size:12px;
  color:#6b7280;
}
.login-card input{
  background:#ffffff;
}
.role-pill{
  font-size:11px;
  background:#e5e7eb;
  border-radius:999px;
  padding:4px 8px;
  display:inline-block;
  margin-top:4px;
}
.badge-user{
  font-size:11px;
  background:#bbf7d0;
  color:#14532d;
  padding:2px 6px;
  border-radius:999px;
  margin-right:4px;
}

/* Daily message */
#dailyMessage{
  background:#bbf7d0;
  color:#14532d;
  padding:10px 15px;
  border-radius:12px;
  margin:10px auto 0 auto;
  font-size:14px;
  font-weight:bold;
  text-align:center;
  max-width:1024px;
  display:none;
}

/* Stats bars */
.stats-block h3{margin:10px 0 5px 0;font-size:14px;}
.stats-row{
  margin-top:4px;
  font-size:12px;
}
.stats-row-label{
  display:flex;
  justify-content:space-between;
}
.stats-bar-bg{
  height:8px;
  border-radius:999px;
  background:#e5e7eb;
  margin-top:3px;
}
.stats-bar-fill{
  height:8px;
  border-radius:999px;
  background:#16a34a;
}
</style>
</head>

<body>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginOverlay">
  <div class="login-card">
    <h1>DSA Lab</h1>
    <p>Ù†Ø¸Ø§Ù… Ù…Ø¹Ù…Ù„ Ø§Ù„Ø£Ø³Ù†Ø§Ù† â€“ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ</p>
    <div class="role-pill">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>

    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
    <input id="loginUser" placeholder="labadmin / assistant / tech / driver"/>

    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
    <input id="loginPass" type="password" placeholder="â€¢â€¢â€¢â€¢"/>

    <button class="action" onclick="doLogin()">Ø¯Ø®ÙˆÙ„</button>

    <div style="text-align:right;margin-top:10px;font-size:11px;color:#6b7280;">
      ØªØ¬Ø±ÙŠØ¨ÙŠÙ‹Ø§ (Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ø­Ø°ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯Ø§Øª):<br>
      <span class="badge-user">labadmin / Lab@2025</span> (Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… â€“ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª)<br>
      <span class="badge-user">assistant / 1111</span> (Ù…Ø³Ø§Ø¹Ø¯Ø©)<br>
      <span class="badge-user">driver / 2222</span> (Ø¹Ø§Ù…Ù„)<br>
      <span class="badge-user">tech / 3333</span> (ÙÙ†ÙŠ)
    </div>
  </div>
</div>

<header>
  <div>
    <div class="title">Ù†Ø¸Ø§Ù… Ù…Ø¹Ù…Ù„ Ø§Ù„Ø£Ø³Ù†Ø§Ù† â€“ DSA Lab</div>
    <div class="subtitle">ØªØªØ¨Ø¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø­ØªÙ‰ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
  </div>
  <div class="brand">
    Internal Use Only<br>
    <b>Dental Lab Workflow</b>
  </div>
</header>

<div id="dailyMessage"></div>

<nav id="mainNav" style="display:none;">
  <button data-sec="clinic" class="active">ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ù„Ø©</button>
  <button data-sec="driver">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ù„</button>
  <button data-sec="assistant">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
  <button data-sec="assign">ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ</button>
  <button data-sec="tech">Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ</button>
  <button data-sec="deliver">Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</button>
  <button data-sec="returned">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø§Ø¬Ø¹Ø©</button>
  <button data-sec="xray">Ø§Ù„Ø£Ø´Ø¹Ø© (R4)</button>
  <button data-sec="stats">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
</nav>

<div class="main">

  <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© -->
  <section class="section" id="clinic">
    <h2>ğŸ“‹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</h2>
    <small>Ù…Ù† Ù‡Ù†Ø§ ÙŠØ¨Ø¯Ø£ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ ÙˆØ§Ù„Ù€ QR Ù„ÙƒÙ„ Ø­Ø§Ù„Ø©.</small>

    <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù (MRN)</label>
    <input id="mrn">

    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</label>
    <input id="pname">

    <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨</label>
    <input id="dname">

    <label>Ø±Ù‚Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</label>
    <input id="cnum">

    <label>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„Ø© (Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ)</label>
    <select id="ctype">
      <option>TM</option><option>CD</option><option>RPD</option>
      <option>PFM</option><option>Ortho</option><option>Resin</option>
    </select>

    <label>Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© (Ø¥Ù† ÙˆÙØ¬Ø¯)</label>
    <select id="deps" multiple>
      <option>TM</option><option>CD</option><option>RPD</option>
      <option>PFM</option><option>Ortho</option><option>Resin</option>
    </select>

    <label>Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø±ÙŠØ¶ Ø§Ù„Ù‚Ø§Ø¯Ù…</label>
    <input type="date" id="nextDate">

    <button class="action" onclick="saveCase()">âœ” Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø±Ù‚Ù… Ù…Ø¹Ù…Ù„</button>

    <div id="qrBox"></div>
  </section>

  <!-- Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ -->
  <section class="section" id="driver">
    <h2>ğŸšš Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</h2>
    <small>Ø§Ù„Ø¹Ø§Ù…Ù„ ÙŠÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ Ø£Ùˆ ÙŠÙ…Ø³Ø­ Ø§Ù„Ù€ QR.</small>
    <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ (Lab ID)</label>
    <input id="driverLab">
    <button class="action" onclick="setStatus('DriverReceived', driverLab)">âœ” ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</button>
  </section>

  <!-- Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© -->
  <section class="section" id="assistant">
    <h2>ğŸ§• Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ø¹Ù…Ù„</h2>
    <small>ØªØ£ÙƒÙŠØ¯ Ø±Ø³Ù…ÙŠ Ø£Ù† Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØµÙ„Øª Ù„Ù„Ù…Ø¹Ù…Ù„.</small>
    <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ (Lab ID)</label>
    <input id="assLab">
    <button class="action" onclick="setStatus('AssistantReceived', assLab)">âœ” ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ù…Ø¹Ù…Ù„</button>
  </section>

  <!-- ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ -->
  <section class="section" id="assign">
    <h2>ğŸ›  ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙÙ†ÙŠ</h2>
    <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ (Lab ID)</label>
    <input id="assignLab">

    <label>Ø§Ø®ØªØ± Ø§Ù„ÙÙ†ÙŠ</label>
    <select id="techName">
      <option>ÙÙ‡Ø¯ (TM)</option>
      <option>Ø£Ø­Ù…Ø¯ (RPD)</option>
      <option>Ø±ÙŠØ§Ø¶ (CD)</option>
    </select>

    <button class="action" onclick="assignTech()">ğŸ“Œ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù„ÙÙ†ÙŠ</button>
  </section>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ -->
  <section class="section" id="tech">
    <h2>ğŸ§‘â€ğŸ”§ Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ</h2>
    <label>Ø§Ø®ØªØ± Ø§Ù„ÙÙ†ÙŠ</label>
    <select id="techFilter">
      <option>ÙÙ‡Ø¯ (TM)</option><option>Ø£Ø­Ù…Ø¯ (RPD)</option><option>Ø±ÙŠØ§Ø¶ (CD)</option>
    </select>
    <button class="action" onclick="loadTechCases()">ğŸ“‚ Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ù„Ù„ÙÙ†ÙŠ</button>
    <div id="techList"></div>
  </section>

  <!-- Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ -->
  <section class="section" id="deliver">
    <h2>ğŸ“¦ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©</h2>
    <small>Ø¨Ø¹Ø¯ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙÙ†ÙŠ ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø­Ø§Ù„Ø©.</small>
    <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ (Lab ID)</label>
    <input id="deliLab">
    <button class="action" onclick="setStatus('Delivered', deliLab)">âœ” ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©</button>
  </section>

  <!-- Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© -->
  <section class="section" id="returned">
    <h2>ğŸ” Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© (ØªØ¹Ø¯ÙŠÙ„/Ù…Ù„Ø§Ø­Ø¸Ø©)</h2>
    <div id="returnedList"></div>
  </section>

  <!-- Ø§Ù„Ø£Ø´Ø¹Ø© -->
  <section class="section" id="xray">
    <h2>ğŸ¦· ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø´Ø¹Ø© (R4)</h2>
    <small>Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø±Ø¨Ø· Ù…Ø¹ R4 Ø¹Ù† Ø·Ø±ÙŠÙ‚ IT (Ø­Ø§Ù„ÙŠÙ‹Ø§ Ù…Ø«Ø§Ù„ ÙÙ‚Ø·).</small>
    <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù (MRN)</label>
    <input id="xmrn">
    <button class="action" onclick="fetchXray()">ğŸ“¥ Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø£Ø´Ø¹Ø©</button>
    <div id="xrayResult" style="margin-top:16px;"></div>
  </section>

  <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
  <section class="section" id="stats">
    <h2>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ© (Ø£Ø³Ø¨ÙˆØ¹ÙŠ / Ø´Ù‡Ø±ÙŠ / Ø³Ù†ÙˆÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…)</h2>
    <div id="statsData"></div>
  </section>

</div>

<footer>
  Â© DSA Lab Workflow â€“ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ ÙÙŠ Ù…Ø¹Ù…Ù„ Ø§Ù„Ø£Ø³Ù†Ø§Ù† â€“ Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… ÙÙ‚Ø· ÙŠØ·Ù‘Ù„Ø¹ Ø¹Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
/* ------------ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† ÙˆØµÙ„Ø§Ø­ÙŠØ§Øª ------------ */
const users = [
  {user:"labadmin",  pass:"Lab@2025", role:"admin"},     // Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
  {user:"assistant", pass:"1111",     role:"assistant"},
  {user:"driver",    pass:"2222",     role:"driver"},
  {user:"tech",      pass:"3333",     role:"tech"}
];
let currentUser = null;

/* ------------ Ø¹Ø¨Ø§Ø±Ø§Øª ØªØ­ÙÙŠØ²ÙŠØ© Ù„ÙƒÙ„ Ø¯ÙˆØ± ------------ */
const roleMessages = {
  admin: [
    "Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙŠÙˆÙ… Ø¨ÙŠØ¯Ùƒâ€¦ ÙˆÙ…Ù† Ø®Ù„Ø§Ù„Ù‡Ø§ ØªÙ‚Ø¯Ø±ÙŠÙ† ØªÙ‚ÙˆØ¯ÙŠÙ† Ø§Ù„ØªØ·ÙˆÙŠØ± ğŸ’š",
    "Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ… ØªØµÙ†Ø¹ Ù‚Ø±Ø§Ø± Ø°ÙƒÙŠ Ø¨ÙƒØ±Ø© âœ¨",
    "ÙƒÙ„ Ø±Ù‚Ù… ÙŠØ­ÙƒÙŠ Ù‚ØµØ©â€¦ ÙˆØ£Ù†ØªÙ Ø§Ù„Ù„ÙŠ ØªÙØ³Ø±ÙŠÙ†Ù‡Ø§ ğŸ‘€",
    "Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡Ø§Ø¯Ø¦ Ù‡Ùˆ Ø³Ø± Ù…Ø¹Ù…Ù„ Ù…Ù†Ø¸Ù‘Ù….",
    "ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ… = ØªØ­Ø³ÙŠÙ† Ø´ØºÙ„ Ø§Ù„Ù…Ø¹Ù…Ù„ ÙƒÙ„Ù‡."
  ],
  assistant: [
    "ØªØ±ØªÙŠØ¨Ùƒ Ù„Ù„Ø­Ø§Ù„Ø§Øª ÙŠØ³Ù‡Ù„ Ø´ØºÙ„ Ø§Ù„Ø¬Ù…ÙŠØ¹ ğŸ¤",
    "ÙƒÙ„ Ø­Ø§Ù„Ø© ØªØ³Ø¬Ù‘Ù„ÙŠÙ†Ù‡Ø§ Ø¨Ø¯Ù‚Ù‘Ø© = Ø­Ø§Ù„Ø© Ø£Ù‚Ù„ ØªØ¶ÙŠØ¹ ğŸ‘Œ",
    "Ø´ØºÙ„Ùƒ Ø§Ù„Ù‡Ø§Ø¯Ø¦ ÙŠØµÙ†Ø¹ Ù†Ø¸Ø§Ù… Ù‚ÙˆÙŠ.",
    "Ø£Ù†ØªÙ Ù‚Ù„Ø¨ Ø§Ù„Ù…Ø¹Ù…Ù„ Ø§Ù„Ù„ÙŠ ÙŠØ¶Ø® Ø§Ù„ØªØ±ØªÙŠØ¨.",
    "Ù…Ù† ÙŠØ¯Ùƒ ØªØ¨Ø¯Ø£ Ø§Ù„Ø­ÙƒØ§ÙŠØ©â€¦ ÙˆÙ…Ù† Ø´ØºÙ„Ùƒ ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù†Ø¸Ø§Ù…."
  ],
  driver: [
    "ØªÙˆØµÙŠÙ„Ùƒ Ù„Ù„Ø­Ø§Ù„Ø§Øª Ø£Ù…Ø§Ù†Ø©â€¦ ÙˆØ£Ù†Øª Ù‚Ø¯Ù‘ Ø§Ù„Ø£Ù…Ø§Ù†Ø© ğŸŒŸ",
    "ÙƒÙ„ Ø­Ø§Ù„Ø© ØªÙˆØµÙ„Ù‡Ø§ ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§ = Ù…Ø±ÙŠØ¶ Ù…Ø±ØªØ§Ø­.",
    "Ø´ØºÙ„Ùƒ ÙŠÙ…ÙƒÙ† Ù…Ø§ ÙŠØ¨Ø§Ù† ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø©â€¦ Ø¨Ø³ ÙŠØ¨Ø§Ù† ÙÙŠ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø´ØºÙ„.",
    "ÙŠØ¹Ø·ÙŠÙƒ Ø§Ù„Ø¹Ø§ÙÙŠØ© Ø¹Ù„Ù‰ ÙƒÙ„ Ù…Ø´ÙˆØ§Ø± ØªØ³ÙˆÙŠÙ‡ ğŸ™",
    "ØªÙˆØµÙŠÙ„ Ù…Ø±ØªØ¨ = Ù…Ø¹Ù…Ù„ Ù…Ø±ØªÙ‘Ø¨."
  ],
  tech: [
    "Ù„Ù…Ø³ØªÙƒ Ø§Ù„ÙÙ†ÙŠØ© ÙˆØ§Ø¶Ø­Ø© ÙÙŠ ÙƒÙ„ Ø­Ø§Ù„Ø© âœ¨",
    "ÙƒÙ„ Ø´ØºÙ„ Ù…ØªÙ‚Ù† ÙŠØ±ÙØ¹ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù…Ù„.",
    "Ø±Ø§Ø­Ø© Ø§Ù„Ù…Ø±ÙŠØ¶ ØªØ¨Ø¯Ø£ Ù…Ù† Ø¯Ù‚Ø© Ø´ØºÙ„Ùƒ.",
    "Ø¥Ø¨Ø¯Ø§Ø¹Ùƒ ÙÙŠ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙŠÙØ±Ù‚ ÙÙŠ Ø§Ù„Ø§Ø¨ØªØ³Ø§Ù…Ø©.",
    "Ø­Ø§Ù„Ø© ÙˆØ±Ø§Ø¡ Ø­Ø§Ù„Ø©â€¦ ØªØµÙŠØ± Ø®Ø¨ÙŠØ± Ù…Ùˆ Ø¨Ø³ ÙÙ†ÙŠ."
  ]
};

/* ------------ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ------------ */
function doLogin(){
  const u = loginUser.value.trim();
  const p = loginPass.value.trim();
  const found = users.find(x => x.user === u && x.pass === p);
  if(!found){
    alert("âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    return;
  }
  currentUser = found;
  loginOverlay.style.display = "none";
  mainNav.style.display = "flex";
  applyRolePermissions();
  setDailyMotivation();
  showSection("clinic");
  showStats();
}

/* ------------ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ± ------------ */
function setDailyMotivation(){
  const role = currentUser?.role || "assistant";
  const box = document.getElementById("dailyMessage");
  const arr = roleMessages[role] || roleMessages["assistant"];
  if(!arr || !arr.length){ box.style.display = "none"; return; }
  const todayIndex = Math.floor(Date.now() / (24*60*60*1000));
  const msg = arr[ todayIndex % arr.length ];
  box.textContent = msg;
  box.style.display = "block";
}

/* ------------ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ------------ */
function applyRolePermissions(){
  const role = currentUser.role;
  document.querySelectorAll("nav button").forEach(btn=>{
    const sec = btn.getAttribute("data-sec");
    let show = false;
    if(role === "admin"){
      show = true; // ÙŠØ´ÙˆÙ ÙƒÙ„ Ø´ÙŠØ¡
    }else if(role === "assistant"){
      show = ["clinic","assistant","assign","returned","xray"].includes(sec);
    }else if(role === "driver"){
      show = ["driver"].includes(sec);
    }else if(role === "tech"){
      show = ["tech","xray"].includes(sec);
    }
    btn.style.display = show ? "inline-block" : "none";
  });
}

/* ------------ ØªÙ†Ù‚Ù„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ------------ */
document.querySelectorAll("nav button").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    showSection(btn.getAttribute("data-sec"));
    if(btn.getAttribute("data-sec")==="stats") showStats();
  });
});

function showSection(id){
  document.querySelectorAll(".section").forEach(s=>s.style.display="none");
  const sec = document.getElementById(id);
  if(sec) sec.style.display="block";
}

/* ------------ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠÙ‘Ø© ------------ */
function getDB(){return JSON.parse(localStorage.getItem("cases")||"[]");}
function saveDB(db){localStorage.setItem("cases",JSON.stringify(db));}

/* ------------ ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ------------ */
function saveCase(){
  let db = getDB();
  const now = Date.now();
  const id = "DSA-" + now;

  const newCase = {
    lab:id,
    mrn:mrn.value,
    pname:pname.value,
    dname:dname.value,
    clinic:cnum.value,
    type:ctype.value,
    depts:Array.from(deps.selectedOptions).map(o=>o.value),
    next:nextDate.value,
    tech:null,
    status:"New",
    createdAt:now,
    history:[{step:"ClinicEntry",by:currentUser?.user || "assistant",time:new Date(now).toLocaleString(),ts:now}]
  };
  db.push(newCase);
  saveDB(db);

  qrBox.innerHTML="";
  new QRCode(qrBox,id);

  alert("âœ” ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ø±Ù‚Ù… Ù…Ø¹Ù…Ù„: "+id);
  showStats();
}

/* ------------ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø¹Ø§Ù…Ø© ------------ */
function setStatus(status, inputEl){
  const id = inputEl.value.trim();
  if(!id){alert("Ø£Ø¯Ø®Ù„ÙŠ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„ Ø£ÙˆÙ„Ø§Ù‹");return;}
  let db = getDB();
  let found = false;
  const now = Date.now();
  db = db.map(c=>{
    if(c.lab === id){
      c.status = status;
      if(!c.history) c.history=[];
      c.history.push({step:status,by:currentUser?.user || "system",time:new Date(now).toLocaleString(),ts:now});
      found = true;
    }
    return c;
  });
  if(!found){
    alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…");
    return;
  }
  saveDB(db);
  alert("âœ” ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© "+id);
  loadReturned();
  showStats();
}

/* ------------ ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ ------------ */
function assignTech(){
  const id = assignLab.value.trim();
  const tech = techName.value;
  if(!id){alert("Ø£Ø¯Ø®Ù„ÙŠ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù…Ù„");return;}

  let db = getDB();
  let found = false;
  const now = Date.now();
  db = db.map(c=>{
    if(c.lab === id){
      c.tech = tech;
      c.status = "WithTech";
      if(!c.history) c.history=[];
      c.history.push({step:"AssignTech:"+tech,by:currentUser?.user || "assistant",time:new Date(now).toLocaleString(),ts:now});
      found = true;
    }
    return c;
  });
  if(!found){alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø©");return;}
  saveDB(db);
  alert("âœ” ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù„ÙÙ†ÙŠ");
  showStats();
}

/* ------------ Ù„ÙˆØ­Ø© Ø§Ù„ÙÙ†ÙŠ ------------ */
function loadTechCases(){
  const tech = techFilter.value;
  const db = getDB();
  const list = db.filter(c=>c.tech === tech);
  let html = "";
  list.forEach(c=>{
    html += `
      <div class="case-card">
        <b>${c.lab}</b> â€” ${c.pname || "Ù…Ø±ÙŠØ¶"}<br>
        Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„Ø©: ${c.type}<br>
        Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${c.status}<br>
        <button class="done" onclick="completeCase('${c.lab}')">âœ” Ø¥Ù†Ù‡Ø§Ø¡</button>
        <button class="ret" onclick="returnCase('${c.lab}')">ğŸ” Ø¥Ø±Ø¬Ø§Ø¹</button>
      </div>
    `;
  });
  techList.innerHTML = html || "<small>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ÙÙ†ÙŠ Ø­Ø§Ù„ÙŠØ§Ù‹.</small>";
}

/* Ø¥Ù†Ù‡Ø§Ø¡ ÙÙ†ÙŠ */
function completeCase(id){
  let db = getDB();
  const now = Date.now();
  db = db.map(c=>{
    if(c.lab === id){
      c.status = "Completed";
      if(!c.history) c.history=[];
      c.history.push({step:"Completed",by:currentUser?.user || "tech",time:new Date(now).toLocaleString(),ts:now});
    }
    return c;
  });
  saveDB(db);
  alert("âœ” ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„Ø©");
  loadTechCases();
  showStats();
}

/* Ø¥Ø±Ø¬Ø§Ø¹ */
function returnCase(id){
  let db = getDB();
  const now = Date.now();
  db = db.map(c=>{
    if(c.lab === id){
      c.status = "Returned";
      if(!c.history) c.history=[];
      c.history.push({step:"Returned",by:currentUser?.user || "tech",time:new Date(now).toLocaleString(),ts:now});
    }
    return c;
  });
  saveDB(db);
  alert("ğŸ” ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© ÙƒÙ€ (Ø±Ø§Ø¬Ø¹Ø©)");
  loadTechCases();
  loadReturned();
  showStats();
}

/* Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© */
function loadReturned(){
  const db = getDB();
  const list = db.filter(c=>c.status === "Returned");
  let html = "";
  list.forEach(c=>{
    html += `<div class="case-card"><b>${c.lab}</b> â€” ${c.pname || ""} | Ù†ÙˆØ¹: ${c.type}</div>`;
  });
  returnedList.innerHTML = html || "<small>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ø±Ø§Ø¬Ø¹Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</small>";
}

/* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø´Ø¹Ø© â€“ Placeholder Ù„Ø±Ø¨Ø· R4 */
function fetchXray(){
  xrayResult.innerHTML = `
    <div class="case-card">
      <b>MRN:</b> ${xmrn.value || "ØºÙŠØ± Ù…Ø¯Ø®Ù„"}<br>
      Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø±Ø¨Ø· Ù…Ø¹ Ù†Ø¸Ø§Ù… R4 Ø¹Ø¨Ø± ÙØ±ÙŠÙ‚ Ø§Ù„Ù€ IT (API / ODBC).<br><br>
      <img src="https://via.placeholder.com/320x200?text=Latest+X-Ray+Preview"
           alt="X-Ray preview" style="width:100%;border-radius:10px;border:1px solid #e5e7eb;">
      <br><small>ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ© Ø³ÙŠØªÙ… Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø£Ø´Ø¹Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† R4 Ùˆ Ø¹Ø±Ø¶Ù‡Ø§ Ù‡Ù†Ø§ Ù„Ù„ÙÙ†ÙŠ.</small>
    </div>
  `;
}

/* ------------ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¥Ù†ØªØ§Ø¬ÙŠØ© (Ø£Ø³Ø¨ÙˆØ¹/Ø´Ù‡Ø±/Ø³Ù†Ø© + Ø£Ù‚Ø³Ø§Ù…) ------------ */
function showStats(){
  const db = getDB();
  const total = db.length;
  const countStatus = st => db.filter(c=>c.status === st).length;

  const now = Date.now();
  function getCompletedCasesWithin(days){
    const from = now - days*24*60*60*1000;
    return db.filter(c=>{
      if(!c.history) return false;
      const comps = c.history.filter(h=>h.step==="Completed");
      if(!comps.length) return false;
      const last = comps[comps.length-1];
      const ts = last.ts || Date.parse(last.time) || 0;
      return ts >= from && ts <= now;
    });
  }

  const depts = ["TM","CD","RPD","PFM","Ortho","Resin"];

  function buildDeptStats(cases){
    const counts = {};
    depts.forEach(d=>counts[d]=0);
    cases.forEach(c=>{
      const main = c.type;
      if(counts[main] != null) counts[main]++;
      if(Array.isArray(c.depts)){
        c.depts.forEach(d=>{
          if(counts[d] != null && d!==main) counts[d]++;
        });
      }
    });
    const max = Math.max(1,...Object.values(counts));
    let html = "";
    depts.forEach(d=>{
      const val = counts[d];
      const width = (val/max)*100;
      html += `
        <div class="stats-row">
          <div class="stats-row-label">
            <span>${d}</span>
            <span>${val} Ø­Ø§Ù„Ø©</span>
          </div>
          <div class="stats-bar-bg">
            <div class="stats-bar-fill" style="width:${width}%;"></div>
          </div>
        </div>
      `;
    });
    return html;
  }

  const weekCases = getCompletedCasesWithin(7);
  const monthCases = getCompletedCasesWithin(30);
  const yearCases = getCompletedCasesWithin(365);

  const html = `
    <div class="case-card">
      <b>Ù…Ù„Ø®Øµ Ø¹Ø§Ù… Ù„Ù„Ø­Ø§Ù„Ø§Øª:</b><br>
      Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª: <b>${total}</b><br>
      Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©: ${countStatus("New")}<br>
      Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ø§Ù…Ù„: ${countStatus("DriverReceived")}<br>
      ÙÙŠ Ø§Ù„Ù…Ø¹Ù…Ù„ (Ø§Ø³ØªÙ„Ø§Ù… Ù…Ø³Ø§Ø¹Ø¯Ø©): ${countStatus("AssistantReceived")}<br>
      Ø¹Ù†Ø¯ Ø§Ù„ÙÙ†ÙŠ: ${countStatus("WithTech")}<br>
      Ù…ÙƒØªÙ…Ù„Ø© Ù…Ù† Ø§Ù„ÙÙ†ÙŠ: ${countStatus("Completed")}<br>
      Ø±Ø§Ø¬Ø¹Ø© (ØªØ¹Ø¯ÙŠÙ„): ${countStatus("Returned")}<br>
      Ù…Ø³Ù„Ù‘Ù…Ø© Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©: ${countStatus("Delivered")}<br>
      <small>Ù„ÙˆØ­Ø© Ø¹Ø§Ù…Ø© Ù„Ù„Ù…Ø¹Ù…Ù„ØŒ Ù„Ø§ ÙŠØ¸Ù‡Ø± ÙÙŠÙ‡Ø§ Ø§Ø³Ù… Ø´Ø®Øµ Ù…Ø¹ÙŠÙ‘Ù†.</small>
    </div>

    <div class="stats-block">
      <h3>ğŸ“… Ø¥Ù†ØªØ§Ø¬ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£Ø®ÙŠØ± (7 Ø£ÙŠØ§Ù…)</h3>
      ${weekCases.length ? buildDeptStats(weekCases) : "<small>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ù…ÙƒØªÙ…Ù„Ø© Ø®Ù„Ø§Ù„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¶ÙŠ.</small>"}
    </div>

    <div class="stats-block">
      <h3>ğŸ—“ï¸ Ø¥Ù†ØªØ§Ø¬ÙŠØ© Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø£Ø®ÙŠØ± (30 ÙŠÙˆÙ…)</h3>
      ${monthCases.length ? buildDeptStats(monthCases) : "<small>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ù…ÙƒØªÙ…Ù„Ø© Ø®Ù„Ø§Ù„ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ.</small>"}
    </div>

    <div class="stats-block">
      <h3>ğŸ“† Ø¥Ù†ØªØ§Ø¬ÙŠØ© Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© (365 ÙŠÙˆÙ…)</h3>
      ${yearCases.length ? buildDeptStats(yearCases) : "<small>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ù…ÙƒØªÙ…Ù„Ø© Ø®Ù„Ø§Ù„ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠØ©.</small>"}
    </div>
  `;
  statsData.innerHTML = html;
}

/* ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ */
showStats();
loadReturned();
</script>

</body>
</html>
